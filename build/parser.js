// Generated by CoffeeScript 1.7.1
(function() {
  window.googlePlusParser = {
    getAllReviews: function() {
      var container;
      container = jq(":contains('All reviews')").last().parent();
      if (container) {
        return jq(container.children()[1]).find("[role='article']");
      }
    },
    verbalizeRate: function(rate) {
      if (rate <= 2) {
        return "negative";
      } else if (rate === 3) {
        return "neutral";
      } else {
        return "positive";
      }
    },
    parseReviews: function() {
      var allReviews, el, link, responseSelector, review, reviews, selectedStartSelector, _base, _i, _len;
      allReviews = window.googlePlusParser.getAllReviews();
      reviews = [];
      for (_i = 0, _len = allReviews.length; _i < _len; _i++) {
        el = allReviews[_i];
        el = jq(el);
        review = {};
        link = el.children().find("a[oid]")[1];
        if (link) {
          review.username = link.innerHTML.split(">").reverse()[0];
          review.imageLink = "http:" + el.find(".we.qAa.M5").attr("src");
          review.userLink = "https://plus.google.com/" + jq(link).attr("href").split("./")[1];
        } else {
          review.username = "A Google User";
        }
        selectedStartSelector = ".b-db-ac.b-db-ac-th";
        review.rate = window.googlePlusParser.verbalizeRate(el.find(selectedStartSelector).length);
        review.content = (typeof (_base = el.find(".GKa.oAa")).html === "function" ? _base.html() : void 0) || "";
        responseSelector = "span.TTb:contains('Response from the owner')";
        review.hasResponse = el.find(responseSelector).length > 0;
        if (review.hasResponse) {
          review.response = el.find(responseSelector).parent().next().html();
        }
        reviews.push(review);
      }
      return reviews;
    }
  };

}).call(this);
